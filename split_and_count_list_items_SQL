with numbers as (
	select cast(row_number()over() as int) as "num"
	from orders
	limit 50 --number of labels never more than 20, overestimate for extreme anomalies 
)
,split_labels as (
    select
		orderid
		,createdate
		,trim(split_part(labels, ',', "num")) as "label"
		,(length(labels) - length(replace(labels,',','')))+1 as "label_count"
	from orders
	cross join numbers
	where "num" <= "label_count"
        and orderstatus = 'completed'
        and department = 1
        and createdate > current_date - 99
)
--end ctes
select 
	"label"
	,count(distinct orderid) as "wo_volume"
	,max(date(calldate)) as "last_create_date"
from split_labels
group by 1
order by 1,2 desc
